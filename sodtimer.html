<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoD Timer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: black;
            color: white;
        }
        .event-section {
            margin-bottom: 30px;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <div id="app" class="container p-5">
        <h1 class="text-center">SoD Timer</h1>
        
        <!-- Stranglethorn Vale PvP Event -->
        <div class="event-section">
            <h2>{{ stranglethornEventStatus }}</h2>
        </div>

        <!-- Ashenvale PvP Event -->
        <div class="event-section">
            <h2>{{ ashenvaleEventStatus }}</h2>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
        function convertToLocalTime(date) {
            const cstOffset = -6; // CST offset from UTC
            const utc = date.getTime() + (date.getTimezoneOffset() * 60000);
            return new Date(utc + (3600000 * cstOffset));
        }

        function isEventActive(eventHour) {
            let now = convertToLocalTime(new Date());
            let eventStartTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), eventHour, 0, 0);
            let eventEndTime = new Date(eventStartTime.getTime() + 1800000); // 30 minutes after event start
            return now >= eventStartTime && now < eventEndTime;
        }

        new Vue({
            el: '#app',
            data: {
                eventDuration: 1800, // 30 minutes in seconds
                stranglethornTimeLeft: null,
                ashenvaleTimeLeft: null,
            },
            computed: {
                stranglethornEventStatus() {
                    if (isEventActive(13) || isEventActive(16) || isEventActive(19)) {
                        return "STRANGLETHORN EVENT IN PROGRESS: " + this.formatTime(this.stranglethornTimeLeft);
                    } else {
                        return "Next StranglethornEvent: " + this.formatTime(this.stranglethornTimeLeft);
                    }
                },
                ashenvaleEventStatus() {
                    if (isEventActive(14) || isEventActive(17) || isEventActive(20)) {
                        return "ASHENVALE EVENT IN PROGRESS: " + this.formatTime(this.ashenvaleTimeLeft);
                    } else {
                        return "Next Ashenvale PvP Event: " + this.formatTime(this.ashenvaleTimeLeft);
                    }
                }
            },
            methods: {
                updateTimers() {
                    let now = convertToLocalTime(new Date());

                    if (isEventActive(13) || isEventActive(16) || isEventActive(19)) {
                        this.stranglethornTimeLeft = this.eventDuration - this.getSecondsPastEvent(13);
                        if (this.stranglethornTimeLeft <= 0) {
                            this.stranglethornTimeLeft = this.getSecondsUntilEvent(13) + this.eventDuration;
                        }
                    } else {
                        this.stranglethornTimeLeft = this.getSecondsUntilEvent(13);
                    }

                    if (isEventActive(14) || isEventActive(17) || isEventActive(20)) {
                        this.ashenvaleTimeLeft = this.eventDuration - this.getSecondsPastEvent(14);
                        if (this.ashenvaleTimeLeft <= 0) {
                            this.ashenvaleTimeLeft = this.getSecondsUntilEvent(14) + this.eventDuration;
                        }
                    } else {
                        this.ashenvaleTimeLeft = this.getSecondsUntilEvent(14);
                    }
                },
                getSecondsUntilEvent(eventHour) {
                    let now = convertToLocalTime(new Date());
                    let nextEventTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), eventHour, 0, 0);
                    if (nextEventTime <= now) {
                        nextEventTime.setHours(nextEventTime.getHours() + 3);
                    }
                    return Math.floor((nextEventTime - now) / 1000);
                },
                getSecondsPastEvent(eventHour) {
                    let now = convertToLocalTime(new Date());
                    let eventStartTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), eventHour, 0, 0);
                    return Math.floor((now - eventStartTime) / 1000);
                },
                formatTime(totalSeconds) {
                    if (totalSeconds < 0) totalSeconds = 0;
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            },
            mounted() {
                this.updateTimers();
                setInterval(() => {
                    this.updateTimers();
                }, 1000);
            }
        });
    </script>
</body>
</html>
